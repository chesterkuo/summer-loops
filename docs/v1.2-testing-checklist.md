# Warmly v1.2 — Testing Checklist

## Feature Overview

| # | Feature | Category | Location | External Dependency |
|---|---------|----------|----------|---------------------|
| 1 | Smart Reminders | AI | Notification Panel | None |
| 2 | Relationship Coach | AI | Dashboard | None |
| 3 | Meeting Prep (Brief) | AI | Profile → Contact | None |
| 4 | Meeting Follow-Up | AI | Profile → Contact | None |
| 5 | Multi-Language AI | Cross-cutting | All AI features | None |
| 6 | LINE Bot | Messaging | Profile → Settings | LINE Official Account |
| 7 | WhatsApp Baileys | Messaging | Profile → Settings | Real WhatsApp account |

---

## Prerequisites

- [ ] Backend running: `pm2 status warmly-backend` shows online
- [ ] Frontend built: `cd frontend && npm run build`
- [ ] Database migrations applied (003, 004, 005)
- [ ] At least 2-3 contacts with interaction history exist in the app
- [ ] Gemini API key configured in `.env`

---

## 1. Smart Reminders

**Location:** Notification bell icon → "AI Suggestions" section at top

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 1.1 | Open Notification Panel | Panel opens, shows existing reminders | [ ] |
| 1.2 | Tap "Refresh" on AI Suggestions | Loading spinner appears, then suggestions load | [ ] |
| 1.3 | Verify suggestion content | Each suggestion shows: contact name, reason text, suggested date | [ ] |
| 1.4 | Tap "Accept" on a suggestion | Suggestion disappears, a real notification/reminder is created | [ ] |
| 1.5 | Verify accepted reminder | New reminder appears in the Active or Upcoming section | [ ] |
| 1.6 | Tap "Dismiss" on a suggestion | Suggestion disappears, no reminder created | [ ] |
| 1.7 | Refresh again | Dismissed suggestion does not reappear | [ ] |

**API endpoints:**
```
POST /api/ai/smart-reminders/analyze
GET  /api/ai/smart-reminders/suggestions
POST /api/ai/smart-reminders/accept/:id
POST /api/ai/smart-reminders/dismiss/:id
```

---

## 2. Relationship Coach

**Location:** Dashboard → "Relationship Coach" card

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 2.1 | Open Dashboard | Relationship Coach card visible below stats | [ ] |
| 2.2 | Tap "Refresh Analysis" | Loading state, then results appear | [ ] |
| 2.3 | Verify attention count | Card shows "X contacts need attention" | [ ] |
| 2.4 | Verify urgent contacts | Top urgent contacts shown with suggested action text | [ ] |
| 2.5 | Expand full view | All contacts grouped into: Urgent / Due / Maintain / Healthy | [ ] |
| 2.6 | Verify health scores | Each contact has a score (0-100) and suggested message | [ ] |
| 2.7 | Refresh again | Results update (scores may change if interactions were added) | [ ] |

**API endpoints:**
```
POST /api/ai/relationship-coach/analyze
GET  /api/ai/relationship-coach/dashboard
```

---

## 3. Meeting Prep (Brief)

**Location:** Profile → Select a contact → "Prep Meeting" button

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 3.1 | Navigate to a contact with interaction history | Contact profile loads | [ ] |
| 3.2 | Tap "Prep Meeting" | Modal opens with loading state | [ ] |
| 3.3 | Verify Summary section | AI-generated summary of the contact | [ ] |
| 3.4 | Verify Talking Points | Bullet list of conversation topics | [ ] |
| 3.5 | Verify Relationship Context | How you met, relationship strength | [ ] |
| 3.6 | Verify Last Interaction | Recap of most recent interaction | [ ] |
| 3.7 | Verify Mutual Connections | Lists shared connections (if any) | [ ] |
| 3.8 | Close modal | Modal closes cleanly | [ ] |
| 3.9 | Test with contact that has no interactions | Brief still generates with available info | [ ] |

**API endpoint:**
```
POST /api/ai/meeting/brief/:contactId
```

---

## 4. Meeting Follow-Up

**Location:** Profile → Select a contact → "Log Meeting" button

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 4.1 | Navigate to a contact profile | Contact profile loads | [ ] |
| 4.2 | Tap "Log Meeting" | Text input modal opens | [ ] |
| 4.3 | Enter natural language note | e.g. "Had coffee, discussed new project. Need to send proposal by Friday. Follow up in 2 weeks." | [ ] |
| 4.4 | Tap "Process with AI" | Loading state, then extracted results appear | [ ] |
| 4.5 | Verify Interaction Logged | Shows interaction type (e.g. "Coffee meeting") and cleaned notes | [ ] |
| 4.6 | Verify Action Items | Extracted action items with due dates | [ ] |
| 4.7 | Verify Follow-Up Reminder | Suggested reminder with date | [ ] |
| 4.8 | Confirm / Close | Data is saved | [ ] |
| 4.9 | Check Recent Interactions | New interaction appears in the contact's interaction history | [ ] |
| 4.10 | Check Notifications | Follow-up reminder appears in notification panel | [ ] |

**API endpoint:**
```
POST /api/ai/meeting/follow-up/:contactId  (body: { noteText: "..." })
```

---

## 5. Multi-Language AI Output

**Location:** All AI features (test with at least 2 different languages)

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 5.1 | Set language to English | Menu → Language → English | [ ] |
| 5.2 | Run Relationship Coach analysis | Suggested actions and messages in English | [ ] |
| 5.3 | Generate Meeting Brief | Brief content in English | [ ] |
| 5.4 | Run Smart Reminders | Suggestion text in English | [ ] |
| 5.5 | Switch to another language (e.g. 繁體中文) | Language changes across app | [ ] |
| 5.6 | Run Relationship Coach analysis | Output in Traditional Chinese | [ ] |
| 5.7 | Generate Meeting Brief | Brief content in Traditional Chinese | [ ] |
| 5.8 | Run Smart Reminders | Suggestion text in Traditional Chinese | [ ] |

---

## 6. LINE Bot Integration

**Location:** Profile (own profile) → Messaging Integrations → LINE

**Prerequisites:**
- [ ] LINE Official Account created at developers.line.biz
- [ ] Messaging API enabled
- [ ] Webhook URL set to `https://mywarmly.app/api/messaging/webhooks/line`
- [ ] `LINE_CHANNEL_SECRET` and `LINE_CHANNEL_ACCESS_TOKEN` in `.env`

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 6.1 | Go to own Profile → Messaging Integrations | LINE section shows "Not connected" | [ ] |
| 6.2 | Tap "Connect" on LINE | Modal opens with 6-digit code and countdown timer | [ ] |
| 6.3 | Open LINE app → Add Warmly bot as friend | Bot account found and added | [ ] |
| 6.4 | Send the 6-digit code to the bot | Bot replies: "Connected to Warmly!" | [ ] |
| 6.5 | Modal auto-closes | LINE section now shows "Connected" with display name | [ ] |
| 6.6 | Send a text message to bot | e.g. "Met John at AWS Summit, senior engineer at Amazon" | [ ] |
| 6.7 | Verify contact created | New contact "John" appears in Warmly with source `line_bot` | [ ] |
| 6.8 | Send a business card photo to bot | Photo of a business card | [ ] |
| 6.9 | Verify OCR contact created | Contact created with extracted name, company, title, etc. | [ ] |
| 6.10 | Tap "Disconnect" on LINE | Status returns to "Not connected" | [ ] |
| 6.11 | Send message to bot after disconnect | Bot replies with linking instructions | [ ] |

---

## 7. WhatsApp Baileys Integration

**Location:** Profile (own profile) → Messaging Integrations → WhatsApp

**Prerequisites:**
- [ ] A real WhatsApp account on your phone
- [ ] Backend running with Baileys package installed
- [ ] Migration 005 applied (whatsapp_sessions, whatsapp_auth_keys, whatsapp_contact_imports tables)

### 7a. Connect Flow

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 7a.1 | Go to own Profile → Messaging Integrations | WhatsApp section shows "Not connected" | [ ] |
| 7a.2 | Tap "Connect" on WhatsApp | Modal opens with phone number input | [ ] |
| 7a.3 | Enter phone number with country code | e.g. "14155551234" (no + sign) | [ ] |
| 7a.4 | Tap "Get Pairing Code" | Loading state, then 8-digit pairing code appears with 60s countdown | [ ] |
| 7a.5 | On phone: WhatsApp → Settings → Linked Devices → Link a Device | Opens device linking screen | [ ] |
| 7a.6 | Tap "Link with Phone Number" | Phone number input appears | [ ] |
| 7a.7 | Enter the 8-digit pairing code | WhatsApp processes the code | [ ] |
| 7a.8 | Wait for connection | Modal auto-closes, status changes to "Connected" with phone number | [ ] |
| 7a.9 | Check backend logs | `pm2 logs warmly-backend` shows "[WhatsApp] User xxx connected" | [ ] |

### 7b. Contact Sync & Import

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 7b.1 | Wait 30-60 seconds after connecting | WhatsApp syncs contacts in background | [ ] |
| 7b.2 | Tap "Import" button on WhatsApp section | Import modal opens with contact list | [ ] |
| 7b.3 | Verify contact list | Shows WhatsApp contacts with names and phone numbers | [ ] |
| 7b.4 | Use "Select All" | All pending contacts are checked | [ ] |
| 7b.5 | Deselect some contacts | Checkboxes toggle correctly | [ ] |
| 7b.6 | Tap "Import X Contact(s)" | Loading state, then modal closes | [ ] |
| 7b.7 | Check Warmly contacts | Imported contacts appear with source `whatsapp_import` | [ ] |
| 7b.8 | Open Import modal again | Previously imported contacts no longer show as pending | [ ] |

### 7c. Disconnect & Reconnect

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 7c.1 | Tap "Disconnect" on WhatsApp | Status returns to "Not connected" | [ ] |
| 7c.2 | Check phone: WhatsApp → Linked Devices | Warmly device may still show (WhatsApp side) | [ ] |
| 7c.3 | Restart backend: `pm2 restart warmly-backend` | Backend starts without errors | [ ] |
| 7c.4 | Check logs | Shows "[WhatsApp] Restoring 0 active session(s)" (since disconnected) | [ ] |

### 7d. Session Persistence (if connected)

| # | Step | Expected Result | Pass |
|---|------|-----------------|------|
| 7d.1 | Connect WhatsApp (steps 7a.1–7a.8) | Status is "Connected" | [ ] |
| 7d.2 | Restart backend: `pm2 restart warmly-backend` | Backend restarts | [ ] |
| 7d.3 | Check logs | Shows "[WhatsApp] Restoring 1 active session(s)" | [ ] |
| 7d.4 | Check WhatsApp status in app | Still shows "Connected" | [ ] |

---

## API Quick Test (curl)

Replace `TOKEN` with a valid JWT from login.

```bash
# Health check
curl https://mywarmly.app/api/health

# Smart Reminders
curl -X POST https://mywarmly.app/api/ai/smart-reminders/analyze \
  -H "Authorization: Bearer TOKEN"

curl https://mywarmly.app/api/ai/smart-reminders/suggestions \
  -H "Authorization: Bearer TOKEN"

# Relationship Coach
curl -X POST https://mywarmly.app/api/ai/relationship-coach/analyze \
  -H "Authorization: Bearer TOKEN"

curl https://mywarmly.app/api/ai/relationship-coach/dashboard \
  -H "Authorization: Bearer TOKEN"

# Meeting Brief (replace CONTACT_ID)
curl -X POST https://mywarmly.app/api/ai/meeting/brief/CONTACT_ID \
  -H "Authorization: Bearer TOKEN"

# Meeting Follow-Up (replace CONTACT_ID)
curl -X POST https://mywarmly.app/api/ai/meeting/follow-up/CONTACT_ID \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"noteText": "Had coffee, discussed project. Follow up next week."}'

# WhatsApp Connect
curl -X POST https://mywarmly.app/api/messaging/whatsapp/connect \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"phoneNumber": "14155551234"}'

# WhatsApp Status
curl https://mywarmly.app/api/messaging/whatsapp/status \
  -H "Authorization: Bearer TOKEN"

# WhatsApp Contacts
curl https://mywarmly.app/api/messaging/whatsapp/contacts \
  -H "Authorization: Bearer TOKEN"

# WhatsApp Disconnect
curl -X POST https://mywarmly.app/api/messaging/whatsapp/disconnect \
  -H "Authorization: Bearer TOKEN"
```

---

## Known Limitations & Risks

- **Baileys is unofficial** — WhatsApp may ban accounts. Contact import (read-only) is lower risk than sending messages.
- **Pairing codes expire in ~60 seconds** — user must enter quickly.
- **Contact sync takes time** — WhatsApp contacts appear gradually after connection, not instantly.
- **Each Baileys session uses ~2-5MB RAM** — monitor if many users connect simultaneously.
- **LINE bot requires external setup** — cannot be tested without LINE Official Account configured.
- **AI features require Gemini API** — will return 503 if API key is missing or quota exceeded.
